{% load static %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'css/global.css' %}" />
    <link rel="stylesheet" href="{% static 'fa/css/all.min.css' %}" />
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@100;200;300;400;500&display=swap"
      rel="stylesheet"
    />
    <title>Cliente - Nuevo</title>
  </head>

  <body class="vw-100 vh-100" style="">
    {% include "nav.html" %}

    <div
      class="container w-100 d-flex justify-content-center align-items-center"
    >

      <div class="card text-dark text-center mt-3 w-75">
        <div class="card-header">
          <h5 class="card-text">
            Datos cliente
        </h5>
        </div>
        <div class="card-body ">
        <div class="card-text">Llene todos los datos del <strong>CLIENTE</strong> </div>
         <form id="form" method="POST" class="text-left">
          {% csrf_token %}
            <div class="form-group">
              <label for="exampleInputEmail1">Tipo Usuario</label>
              </br>
              <label><strong> {{tipo_usuario}}</strong></label>
              <input
                style="opacity:0;height:10px"
                required                
                class="form-control form-control-sm"
                id="exampleInputEmail1"
                aria-describedby="emailHelp"
                placeholder="Tipo usuario"
                value="{{tipo_usuario}}"
                name="last_name"
              />
            </div>
            <div class="form-group">
              <label for="exampleInputEmail1">Cedula</label>
              <input
                required
                class="form-control"
                id="username"
                type="number"
                aria-describedby="emailHelp"
                placeholder="Cedula"                
                name="username"
              />
            </div>
             <div class="form-group">
              <label for="exampleInputEmail1">Dirección</label>
              <input
                required
                class="form-control"
                id="exampleInputEmail1"
                aria-describedby="emailHelp"
                placeholder="Direccion"
                name="direccion"
              />
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Nombres</label>
              <input
              required
                type="text"
                class="form-control"
                id="exampleInputPassword1"
                placeholder="Nombres"
                name="first_name"
                
              />
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Correo electrónico</label>
              <input
              required
                type="email"
                class="form-control"
                id="exampleInputPassword1"
                placeholder="Correo electrónico"
                name="email"
              />
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Contraseña</label>
              <input
              required
                type="password"
                class="form-control"
                id="exampleInputPassword1"
                placeholder="Contraseña"
                name="password"
              />
            </div>      
            <div class="form-group">
              <label for="exampleInputPassword1">Agencia</label>
               <select class="form-select" aria-label="Default select example" id="floatingInput" name="agencia">
            <option value="0" selected>Agencia</option>
            {% for agencia in agencias  %}
            <option value={{agencia.id}}>{{agencia.nombre}}</option>
            {% endfor %}
          
          </select>
            </div>      

            </br>
            <div class="text-center">
            <a href="/clientes/" type="submit" class="btn btn-danger mr-3">REGRESAR</a>
            <input value="CREAR CLIENTE" type="submit" class="btn btn-primary text-center">
            </div>
              
           
            {% if error %}
                {{error}}
            {% endif %}
          </form>
         
        </div>
      </div>
    </div>
  

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>


  <script src="/static/js/jquery-3.1.1.min.js"></script>
  <script src="/static/pantallap/lib/bootstrap/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="/static/pantallap/lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="/static/pantallap/lib/jquery.scrollTo.min.js"></script>
  <script src="/static/pantallap/lib/jquery.nicescroll.js" type="text/javascript"></script>

  <script src="http://maps.google.com/maps/api/js?sensor=false&libraries=geometry&v=3.7"></script>
  <script src="/static/pantallap/lib/google-maps/maplace.js"></script>
  <script src="/static/pantallap/lib/google-maps/data/points.js"></script>

  <script src="/static/pantallap/lib/bootstrap/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="/static/pantallap/lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="/static/pantallap/lib/jquery.scrollTo.min.js"></script>
  <script src="/static/pantallap/lib/jquery.nicescroll.js" type="text/javascript"></script>
  <script src="/static/pantallap/lib/jquery.sparkline.js"></script>
  <script src="/static/pantallap/lib/common-scripts.js" ></script>
  <script type="text/javascript" src="/static/pantallap/lib/gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="/static/pantallap/lib/gritter-conf.js"></script>
  <script src="/static/pantallap/lib/sparkline-chart.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
  <script src="/static/lib/sweetalert2-9.10.0/sweetalert2.all.min.js"></script>
  <script src="/static/lib/adminlte-3.0.4/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/static/lib/adminlte-3.0.4/js/adminlte.min.js"></script>
  <script src="/static/main.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="/static/lib/jquery-confirm-v3.3.4/jquery-confirm.min.js"></script>    
  <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.10.25/af-2.3.7/b-1.7.1/rr-1.2.8/sp-1.3.0/datatables.min.js"></script>
  
<link href="https://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script src="https://code.jquery.com/ui/1.11.0/jquery-ui.min.js"></script>


<script src="https://trentrichardson.com/examples/timepicker/jquery-ui-timepicker-addon.js"></script>
  </body>
</html>

<link href="https://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script src="https://code.jquery.com/ui/1.11.0/jquery-ui.min.js"></script>




<script>
  
    $(function(){

       
 function validar() {
        var cad = $("#username").val().trim();
        var total = 0;
        var longitud = cad.length;
        var longcheck = longitud - 1;
        console.log("llego")
        console.log(longitud)
        console.log(cad)
        if (cad !== "" && longitud === 10){
          for(i = 0; i < longcheck; i++){
            if (i%2 === 0) {
              var aux = cad.charAt(i) * 2;
              if (aux > 9) aux -= 9;
              total += aux;
            } else {
              total += parseInt(cad.charAt(i)); // parseInt o concatenará en lugar de sumar
            }
          }

        console.log("paso")
          total = total % 10 ? 10 - total % 10 : 0;

          if (cad.charAt(longitud-1) == total) {
            return true;           
          }else{
           
             messageError("Cedula invalida");
            return false;
          }
        }else{
           messageError("La cedula es incorrecta");
        }
      }


        
        function messageError(text){
            Swal.fire({
            title:'ERRROR',
            html: '<pre style="text-align: initial !important;">' + text + '</pre>',
            icon:'error',
            confirmButtonColor:'#d33',
            confirmButtonText:'Aceptar'
        })}

        function messageSuccess(text){
            Swal.fire({
            title:'EXITO',
            html: '<pre style="text-align: initial !important;">' + text + '</pre>',
            icon:'success',
            confirmButtonColor:'green',
            confirmButtonText:'Aceptar'
        }).then((result) => {
  /* Read more about isConfirmed, isDenied below */
  if (result.isConfirmed) {
   location.href=location.protocol+"//"+location.host+"/registro_pagos/";
  } 
})
        }
        var url=$("form").attr("action")
        var token=$("[name=csrfmiddlewaretoken]").val()

        $("#form").submit(function(e){
            e.preventDefault()
            console.log("tipe")
            console.log(e)
            let formdata=$("form").serializeArray()
            validar()
           if(validar()){
$.ajax({
                method: "POST",
                url: url,
                data: formdata,
                headers:{'X-CSRFToken':token},
                }).done(function(r,textStatus,xhr){                  
                if(xhr.status==200){
                    messageSuccess("Se creo exitosamente")
                   
                  
                }else{
                    console.log("text",textStatus)
                    messageError(textStatus);
                }
               
            }).fail(function(error){               
                let ar=JSON.parse(error.responseText)              
                console.log(ar)               
                let obe = Object.values(ar);
             
                let mensaje=""
                for (var k in obe) {
                    if ((Number(k) + 1) === obe.length) {
                        mensaje+="- "+obe[k][0]
                    }else{
                    mensaje+= "- "+obe[k][0]+"\n"

                    }
                    
                }
                
               
                 messageError(mensaje)
                
            });
           }
            
        })
    })

     
</script>
